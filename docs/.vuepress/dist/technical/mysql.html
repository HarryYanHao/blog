<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>mysql 学习 | 哈里小屋</title>
    <meta name="description" content="记录生活，记录成长">
    
    
    <link rel="preload" href="/assets/css/0.styles.eed6359e.css" as="style"><link rel="preload" href="/assets/js/app.3f7c9071.js" as="script"><link rel="preload" href="/assets/js/2.329bf15c.js" as="script"><link rel="preload" href="/assets/js/16.34c2b8f7.js" as="script"><link rel="prefetch" href="/assets/js/10.653b249d.js"><link rel="prefetch" href="/assets/js/11.06ada350.js"><link rel="prefetch" href="/assets/js/12.baed343e.js"><link rel="prefetch" href="/assets/js/13.aef00750.js"><link rel="prefetch" href="/assets/js/14.acd08f94.js"><link rel="prefetch" href="/assets/js/15.8080dc46.js"><link rel="prefetch" href="/assets/js/17.181b0bdd.js"><link rel="prefetch" href="/assets/js/18.b186e74d.js"><link rel="prefetch" href="/assets/js/3.dd292a33.js"><link rel="prefetch" href="/assets/js/4.a85b5129.js"><link rel="prefetch" href="/assets/js/5.ce45d0ba.js"><link rel="prefetch" href="/assets/js/6.7c3b3b33.js"><link rel="prefetch" href="/assets/js/7.e20c90d7.js"><link rel="prefetch" href="/assets/js/8.cc5eb07a.js"><link rel="prefetch" href="/assets/js/9.4f68c740.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eed6359e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container common"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">哈里小屋</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/technical/" class="nav-link router-link-active">技术文档</a></div><div class="nav-item"><a href="/article/" class="nav-link">随笔</a></div> <a href="https://github.com//HarryYanHao" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/technical/" class="nav-link router-link-active">技术文档</a></div><div class="nav-item"><a href="/article/" class="nav-link">随笔</a></div> <a href="https://github.com//HarryYanHao" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>mysql 学习</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/technical/mysql.html#mac下安装与使用" class="sidebar-link">mac下安装与使用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/technical/mysql.html#sql语句优化" class="sidebar-link">sql语句优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical/mysql.html#开启查询缓存" class="sidebar-link">开启查询缓存</a></li><li class="sidebar-sub-header"><a href="/technical/mysql.html#用explain检查sql" class="sidebar-link">用explain检查sql:</a></li><li class="sidebar-sub-header"><a href="/technical/mysql.html#为搜索的字段添加索引" class="sidebar-link">为搜索的字段添加索引</a></li><li class="sidebar-sub-header"><a href="/technical/mysql.html#根据业务逻辑优化sql语句" class="sidebar-link">根据业务逻辑优化sql语句</a></li><li class="sidebar-sub-header"><a href="/technical/mysql.html#建表时选择合适的数据类型" class="sidebar-link">建表时选择合适的数据类型</a></li><li class="sidebar-sub-header"><a href="/technical/mysql.html#尽可能的不要将字段值存储为null" class="sidebar-link">尽可能的不要将字段值存储为null</a></li><li class="sidebar-sub-header"><a href="/technical/mysql.html#使用预处理语句" class="sidebar-link">使用预处理语句</a></li><li class="sidebar-sub-header"><a href="/technical/mysql.html#垂直分割和越小的列" class="sidebar-link">垂直分割和越小的列</a></li><li class="sidebar-sub-header"><a href="/technical/mysql.html#选择合适的搜索引擎" class="sidebar-link">选择合适的搜索引擎</a></li><li class="sidebar-sub-header"><a href="/technical/mysql.html#将大的sql语句拆分成小段sql" class="sidebar-link">将大的sql语句拆分成小段sql</a></li></ul></li><li><a href="/technical/mysql.html#对已有表进行优化方法" class="sidebar-link">对已有表进行优化方法</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mysql-学习"><a href="#mysql-学习" aria-hidden="true" class="header-anchor">#</a> mysql 学习</h1> <p></p><div class="table-of-contents"><ul><li><a href="#mac下安装与使用">mac下安装与使用</a></li><li><a href="#sql语句优化">sql语句优化</a><ul><li><a href="#开启查询缓存">开启查询缓存</a></li><li><a href="#用explain检查sql">用explain检查sql:</a></li><li><a href="#为搜索的字段添加索引">为搜索的字段添加索引</a></li><li><a href="#根据业务逻辑优化sql语句">根据业务逻辑优化sql语句</a></li><li><a href="#建表时选择合适的数据类型">建表时选择合适的数据类型</a></li><li><a href="#尽可能的不要将字段值存储为null">尽可能的不要将字段值存储为null</a></li><li><a href="#使用预处理语句">使用预处理语句</a></li><li><a href="#垂直分割和越小的列">垂直分割和越小的列</a></li><li><a href="#选择合适的搜索引擎">选择合适的搜索引擎</a></li><li><a href="#将大的sql语句拆分成小段sql">将大的sql语句拆分成小段sql</a></li></ul></li><li><a href="#对已有表进行优化方法">对已有表进行优化方法</a></li></ul></div><p></p> <h2 id="mac下安装与使用"><a href="#mac下安装与使用" aria-hidden="true" class="header-anchor">#</a> mac下安装与使用</h2> <p>推荐使用brew安装</p> <div class="language-sh extra-class"><pre class="language-sh"><code>brew <span class="token function">install</span> mysql
</code></pre></div><p>查看mysql的配置文件路径</p> <div class="language-sh extra-class"><pre class="language-sh"><code>mysql —help <span class="token operator">|</span><span class="token function">grep</span> my.cnf
</code></pre></div><p>查看配置</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">show</span> variables<span class="token punctuation">;</span>
</code></pre></div><h2 id="sql语句优化"><a href="#sql语句优化" aria-hidden="true" class="header-anchor">#</a> sql语句优化</h2> <h3 id="开启查询缓存"><a href="#开启查询缓存" aria-hidden="true" class="header-anchor">#</a> 开启查询缓存</h3> <p>[mysqld]中添加：</p> <div class="language- extra-class"><pre class="language-text"><code>query_cache_size = 20M
query_cache_type = ON
</code></pre></div><p>举例说明命中查询缓存的语句:
用变量接收查询条件</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> music163 <span class="token keyword">where</span> create_time <span class="token operator">=</span> <span class="token string">'2019-06-14 00:00:00'</span><span class="token punctuation">;</span>
</code></pre></div><p>不命中查询缓存的语句:
在sql语句中直接使用函数</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> music163 <span class="token keyword">where</span> create_time <span class="token operator">=</span> curdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="用explain检查sql"><a href="#用explain检查sql" aria-hidden="true" class="header-anchor">#</a> 用explain检查sql:</h3> <p>主要观察的指标有type和rows 前者会告诉你索引主键被如何利用后者会告诉你遍历了多少条数据，rows越少速度越快</p> <h3 id="为搜索的字段添加索引"><a href="#为搜索的字段添加索引" aria-hidden="true" class="header-anchor">#</a> 为搜索的字段添加索引</h3> <p>某个字段你需要用于where后的查询条件，为其添加索引
特别说明：当添加联合索引时，在单个条件查询中 只有联合索引中的第一个生效，其余的不生效。</p> <h3 id="根据业务逻辑优化sql语句"><a href="#根据业务逻辑优化sql语句" aria-hidden="true" class="header-anchor">#</a> 根据业务逻辑优化sql语句</h3> <p>使用limit限制查询条数，需要哪列数据写到查询语句，不要使用*来查询</p> <h3 id="建表时选择合适的数据类型"><a href="#建表时选择合适的数据类型" aria-hidden="true" class="header-anchor">#</a> 建表时选择合适的数据类型</h3> <p>例如在枚举字段中 用enum 会比varchar 更加快捷紧凑，对数据长度进行一定的限制</p> <h3 id="尽可能的不要将字段值存储为null"><a href="#尽可能的不要将字段值存储为null" aria-hidden="true" class="header-anchor">#</a> 尽可能的不要将字段值存储为null</h3> <p>尽量让字段保持not null 因为存储null也是需要额外的空间，和上一条一样，尽量减少存储空间，加快搜索速度</p> <h3 id="使用预处理语句"><a href="#使用预处理语句" aria-hidden="true" class="header-anchor">#</a> 使用预处理语句</h3> <p>首先使用预处理可以保证程序避免遭受sql注入攻击，同时，在相同查询被多次使用的时候，mysql对预处理只会解析一次</p> <h3 id="垂直分割和越小的列"><a href="#垂直分割和越小的列" aria-hidden="true" class="header-anchor">#</a> 垂直分割和越小的列</h3> <p>我们都知道一张表列数越少数据在硬盘中存储的越紧凑查询速度越快，所以我们要尽量避免一张表有特别多的列，如果一张表中存在特别多的列我们需要垂直分割，垂直分割的方法有多种多样，可以根据业务类型拆分，也可以根据数据是否经常变化来进行拆分。</p> <h3 id="选择合适的搜索引擎"><a href="#选择合适的搜索引擎" aria-hidden="true" class="header-anchor">#</a> 选择合适的搜索引擎</h3> <p>搜索引擎主要有myisam和innodb 简单来说myisam适合读密集型的业务类型，innodb适合写密集型的业务，myisam不支持事物，innodb支持事物，myisam是表锁 innodb是行锁</p> <h3 id="将大的sql语句拆分成小段sql"><a href="#将大的sql语句拆分成小段sql" aria-hidden="true" class="header-anchor">#</a> 将大的sql语句拆分成小段sql</h3> <p>如果执行大段的sql，特别是insert和delete可能会导致锁表，其他进程访问造成阻塞，进程hang住，从而导致web服务器crash</p> <h2 id="对已有表进行优化方法"><a href="#对已有表进行优化方法" aria-hidden="true" class="header-anchor">#</a> 对已有表进行优化方法</h2> <p>1.首先利用上述的方法对sql语句进行优化<br>
2.利用memcached 和 redis 做一层缓存 内存查询的速度快于硬盘读取速度<br>
3.读写分离 在应用层面主从复制 或 主主复制 主写从读  可使用第三方轮子atlas<br>
4.使用mysql自带的分区表 无需更改代码,但是sql语句是需要针对分区表做优化的，sql条件中要带上分区条件的列，从而使查询定位到少量的分区上<br>
5.垂直拆分表<br>
6.水平拆分<br>
成本又低到高 成本越高效果越好</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/2/2019, 4:07:33 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.3f7c9071.js" defer></script><script src="/assets/js/2.329bf15c.js" defer></script><script src="/assets/js/16.34c2b8f7.js" defer></script>
  </body>
</html>
